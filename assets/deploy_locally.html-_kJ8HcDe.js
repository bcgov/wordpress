import{_ as s,c as n,e as a,o as t}from"./app-DCBtsDhP.js";const o="/wordpress/assets/keychainSnippet-BteyvW7O.png",i="/wordpress/assets/wordpressInitialSetup-B9B3SLOL.png",l="/wordpress/images/max-upload-file-size.png",p={};function c(r,e){return t(),n("div",null,[...e[0]||(e[0]=[a(`<h1 id="deploying-wordpress-to-docker" tabindex="-1"><a class="header-anchor" href="#deploying-wordpress-to-docker"><span>Deploying WordPress to Docker</span></a></h1><h2 id="setup" tabindex="-1"><a class="header-anchor" href="#setup"><span>Setup</span></a></h2><p>Clone this repository, and go to the dev directory</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Clone WordPress deployment repository</span></span>
<span class="line"><span class="token function">git</span> clone https://github.com/bcgov/wordpress.git</span>
<span class="line"><span class="token comment"># Change directory to the wordpress/dev folder</span></span>
<span class="line"><span class="token builtin class-name">cd</span> wordpress/dev</span>
<span class="line"><span class="token comment"># Create an .env by copying the sample .env</span></span>
<span class="line"><span class="token function">cp</span> sample-env .env</span>
<span class="line"></span></code></pre></div><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>you should be using <a href="https://github.com/bcgov/wordpress" target="_blank" rel="noopener noreferrer">https://github.com/bcgov/wordpress</a> as your local WordPress development. ensure you pull the latest: <code>git pull origin main</code> before you start working on your local WordPress development.</p></div><h2 id="environment-basics" tabindex="-1"><a class="header-anchor" href="#environment-basics"><span>Environment Basics</span></a></h2><ul><li>Update variables inside <code>.env</code> file to reflect your setup. <ul><li>The <code>CONTENT_DIR</code> variable is the location of your WordPress content directory.</li><li>The <code>TEMP_DIR</code> variable can be used to import/export db using the wp-cli command.</li></ul></li></ul><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>When Importing and Exporting databases with the <code>wp cli</code> This will be the link between the WordPress container and your local machine.</p></div><div class="hint-container warning"><p class="hint-container-title">Optional: Switching to Rancher Desktop</p><p>If you are using Docker Desktop, you can switch to Rancher Desktop. This is not required, but it is recommended for a more stable experience. Rancher Desktop is a free and open-source desktop application that is designed to be lightweight and easy to use.</p><p>If you want to use Rancher Desktop:</p><ul><li>Uninstall Docker Desktop</li><li>Install and start Rancher Desktop: https://rancherdesktop.io/</li><li>Don&#39;t enable Kubernetes</li><li>run <code>wp_start</code> (might have to do this 2x and it should create a network)</li><li><code>wp db import /tmp/WordPress/all-sites-2025-04-03.sql</code> (or whatever the name of your file is) your site should now be back to normal.</li></ul></div><h2 id="setting-up-ssl-on-mac-required" tabindex="-1"><a class="header-anchor" href="#setting-up-ssl-on-mac-required"><span>Setting up SSL on Mac (required)</span></a></h2><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Make sure you are in the folder: <strong><code>{local repo location}/dev</code></strong> before you run the command below.</p></div><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># sets up \`localhost\` self signed certs.</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token parameter variable">--file</span> docker-compose-init.yaml run self-signed-certificate-generator</span>
<span class="line"></span></code></pre></div><ul><li><p>Drag the cert located in <strong><code>{local repo location}/dev/certs/nginx/ssl/localhost.crt</code></strong> to <a href="https://support.apple.com/en-ca/guide/keychain-access/kyca2431/mac" target="_blank" rel="noopener noreferrer">KeyChain app</a> section and trust always:</p><ul><li>Double-click the certificate.</li><li>Next to Trust, click the arrow and in the dropdown box for &quot;When using this certificate:&quot; select <code>Always Trust</code>.</li></ul></li></ul><p><img src="`+o+`" alt="keychainSnippet"></p><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>If this cert is not working, try refreshing the Keychain or verifying the certificate installation before considering a Mac restart as a last resort.</p></div><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>WordPress will now run on localhost port 443, which is exactly the same port that Kubernetes runs on. Therefore, local Kubernetes and WordPress can&#39;t be running at the same time.</p></div><h2 id="run-docker-compose" tabindex="-1"><a class="header-anchor" href="#run-docker-compose"><span>Run Docker compose</span></a></h2><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>You have to be in the wordpress/dev directory for this to work</p></div><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Starts WordPress deployment</span></span>
<span class="line"><span class="token function">docker</span> compose up</span>
<span class="line"><span class="token comment"># to re-build the images and start WordPress deployment</span></span>
<span class="line"><span class="token comment"># The build flag is required, anytime there are changes to the images.</span></span>
<span class="line"><span class="token function">docker</span> compose up <span class="token parameter variable">--build</span></span>
<span class="line"><span class="token comment"># If you enable build in shell scripts, this scripts works from anywhere</span></span>
<span class="line"><span class="token comment"># Starts WordPress deployments</span></span>
<span class="line">wp_start</span>
<span class="line"><span class="token comment"># Creating a unique WordPress build by using alternative env, and different database</span></span>
<span class="line"><span class="token function">docker</span> compose <span class="token parameter variable">-p</span> mysite --env-file .env-mysite up</span>
<span class="line"></span></code></pre></div><ul><li>ensure that the wp-cli container backs up the latest WP Database</li><li>You should see the following in the terminal:</li></ul><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token punctuation">..</span>.</span>
<span class="line">wp-cli-1 <span class="token operator">|</span> *** Backing up Database <span class="token keyword">in</span> <span class="token keyword">case</span> of disaster ***</span>
<span class="line">wp-cli-1 <span class="token operator">|</span> Success: Exported to <span class="token string">&#39;/tmp/WordPress/all-sites-&lt;yyyy-mm-dd&gt;.sql&#39;</span><span class="token builtin class-name">.</span></span>
<span class="line"><span class="token comment"># (This should be accessible to ~/tmp/WordPress)</span></span>
<span class="line"><span class="token punctuation">..</span>.</span>
<span class="line"></span></code></pre></div><ul><li>Access Wordpress at <a href="https://localhost" target="_blank" rel="noopener noreferrer">https://localhost</a></li><li>Access PHPMyAdmin at <a href="http://localhost:8081" target="_blank" rel="noopener noreferrer">http://localhost:8081</a> (Note: does not use https)</li></ul><p>When you access Wordpress local for the first time, you will be prompted with the initial setup. You can use this screenshot for reference for what to enter.</p><p><img src="`+i+'" alt="wordpressInitialSetup"></p><p>Once you have filled out all required inputs, click &quot;Install WordPress&quot;</p><h2 id="recommended-multi-site-configuration" tabindex="-1"><a class="header-anchor" href="#recommended-multi-site-configuration"><span>Recommended multi-site configuration</span></a></h2><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>WordPress (WP) multi-site is a configuration that enables multiple websites on the same WP installation.</p></div><ul><li><p>In the WordPress admin UI, go to menu Tools -&gt; Network Setup and click install</p></li><li><p>Bring down the WordPress site <code>docker compose down</code> (or &lt;CTRL&gt;-C if docker is in the foreground and then <code>docker compose down</code>).</p></li><li><p>In your <code>.env</code> file, ensure</p><ul><li><code>MULTISITE=1</code></li></ul></li><li><p>Bring up WordPress site <code>docker compose up</code></p></li><li><p>In the WordPress admin UI, go to My Sites -&gt; Network Admin -&gt; Settings and <code>change Max upload file size</code> to 10000 and click <code>Save Changes</code></p></li></ul><img src="'+l+`" style="max-width:250px;margin:1rem 0;"><ul><li>The WordPress wp-content directory can be found at the path specified in your <code>.env</code> file under the <code>CONTENT_DIR</code> variable.</li></ul><h2 id="running-thereafter" tabindex="-1"><a class="header-anchor" href="#running-thereafter"><span>Running Thereafter</span></a></h2><ul><li><p><code>docker compose up</code> runs the nginx, db, WordPress php-fpm, and wp-cli containers, this will also output debug.log in the stdout.</p></li><li><p>WordPress wp-content directory, can be found at the path specified in your <code>.env</code> under variable <code>CONTENT_DIR</code>, .</p></li></ul><h2 id="creating-an-alternative-wordpress-instance" tabindex="-1"><a class="header-anchor" href="#creating-an-alternative-wordpress-instance"><span>Creating an Alternative WordPress Instance</span></a></h2><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>This is useful for working on projects, where the database, and resources can be distributed in a way, that only requires a simple database import, and file extraction.</p></div><p>There are two variations that can be used, one is by using the existing <code>.env</code> or by creating an alternative <code>.env-mysite</code> file in which a new location could be setup.</p><p>The <code>wp</code> cli might no longer work, here are the two solutions</p><ul><li>download latest version of https://github.com/bcgov/wordpress, as it has a fix, and allows any project, to execute the <code>wp</code> cli command</li><li>manually shell into container <ul><li><code>docker exec -it mysite-wp-cli-1 sh</code></li><li>use the wp cli command</li></ul></li></ul><h3 id="creating-with-existing-env" tabindex="-1"><a class="header-anchor" href="#creating-with-existing-env"><span>Creating with Existing .env</span></a></h3><p>Choosing the existing <code>.env</code> file, the <code>MULTISITE</code> variable will need to be set to <code>0</code>, until the multi-site installation has been completed, this instance will be constrained to the same <code>uploads</code> folder structure. Possibly causing conflicts with existing assets.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># ensure a full docker compose down has been completed</span></span>
<span class="line"><span class="token function">docker</span> <span class="token function">composer</span> down</span>
<span class="line"><span class="token comment"># update your .env file MULTISITE=0</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Run the docker compose up with the --project-name (-p) </span></span>
<span class="line"><span class="token comment">#   to prepend all containers, and volumes with this project name</span></span>
<span class="line"><span class="token function">docker</span> compose --project-name mysite up</span>
<span class="line"><span class="token comment"># Follow the \`Recommended multi-site configuration\` </span></span>
<span class="line"><span class="token comment">#   (In the WordPress admin UI, go to menu</span></span>
<span class="line"><span class="token comment">#   Tools -&gt; Network Setup and click install)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Do a docker compose down with the project name</span></span>
<span class="line"><span class="token function">docker</span> compose --project-name mysite down</span>
<span class="line"><span class="token comment"># update your .env file back to MULTISITE=1</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># For any future times run the docker compose up command with the project name</span></span>
<span class="line"><span class="token function">docker</span> compose --project-name mysite up</span>
<span class="line"></span></code></pre></div><h3 id="creating-with-new-env-mysite" tabindex="-1"><a class="header-anchor" href="#creating-with-new-env-mysite"><span>Creating with New .env-mysite</span></a></h3><p>Choosing a new environment file <code>.env-mysite</code> allows for a clean installation, providing the <code>CONTENT_DIR</code> and <code>WORDPRESS_DIR</code> are different than the original installation. The disadvantage is multiple copies of plugins/themes.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># ensure a full docker compose down has been completed</span></span>
<span class="line"><span class="token function">docker</span> <span class="token function">composer</span> down</span>
<span class="line"><span class="token comment"># update your .env-mysite file MULTISITE=0, and CONTENT_DIR to new directory</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Run the docker compose up with the --project-name (-p) </span></span>
<span class="line"><span class="token comment">#   to prepend all containers, and volumes with this project name</span></span>
<span class="line"><span class="token comment">#   use a specific env file</span></span>
<span class="line"><span class="token function">docker</span> compose --project-name mysite --env-file .env-mysite up</span>
<span class="line"><span class="token comment"># Follow the \`Recommended multi-site configuration\` </span></span>
<span class="line"><span class="token comment">#   (In the WordPress admin UI, go to menu</span></span>
<span class="line"><span class="token comment">#   Tools -&gt; Network Setup and click install)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Do a docker compose down with the project name</span></span>
<span class="line"><span class="token function">docker</span> compose --project-name mysite down</span>
<span class="line"><span class="token comment"># update your .env file back to MULTISITE=1</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># For any future times run the docker compose up command with the project name and env file</span></span>
<span class="line"><span class="token function">docker</span> compose --project-name mysite --env-file .env-mysite  up</span>
<span class="line"></span></code></pre></div><h2 id="helper-functions" tabindex="-1"><a class="header-anchor" href="#helper-functions"><span>Helper functions</span></a></h2><p>The <a href="./bin/commands.sh">Helper functions</a> can be linked to run anytime a new terminal window is open by adding it to your <code>~/.bash_profile</code></p><h3 id="including-helper-functions-in-bash-profile" tabindex="-1"><a class="header-anchor" href="#including-helper-functions-in-bash-profile"><span>Including helper functions in bash profile</span></a></h3><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>In order to make the helper functions accessible you need to include them into your bash or zsh profile. These commands then can be run from anywhere on your file system from a terminal window.</p></div><p>If you are using bash, add this to your <code>~/.bash_profile</code>. If you are using Zsh, add this to your <code>~/.zshrc</code>.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> /location-of-this-repo/wordpress/dev/bin/commands.sh <span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line"> <span class="token builtin class-name">.</span> /location-of-this-repo/wordpress/dev/bin/commands.sh</span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Once this is done you can use the following commands from any directory</p><ul><li><code>wp_start</code> - Starts WordPress local deployment (docker)</li><li><code>wp_stop</code> - Stops WordPress local deployment (docker)</li><li><code>wp_log</code> - Tails the debug.log in the content directory</li><li><code>gowp</code> - Goes to plugin directory</li><li><code>gowp themes</code> - Goes to themes directory</li><li><code>wp_setup_tests</code> - Sets up WordPress unit testing environment. See the Unit tests section below for instructions.</li><li><code>wp_test</code> - Runs unit tests from the current directory.</li><li><code>wpgrep</code> - Does a grep with certain excludes to directories like .git, node_modules, vendor</li><li><code>wp_composer</code> - Runs the latest php composer</li><li><code>wp</code> - <a href="https://wp-cli.org/" target="_blank" rel="noopener noreferrer">Wordpress Command line</a> that allows an endless amount of things to be completed with your local WordPress instance.</li></ul><h2 id="example-wordpress-command-line-using-wp" tabindex="-1"><a class="header-anchor" href="#example-wordpress-command-line-using-wp"><span>Example <a href="https://developer.wordpress.org/cli/commands/" target="_blank" rel="noopener noreferrer">WordPress Command Line</a> using wp.</span></a></h2><ul><li><code>wp site list</code> - Shows all the sites.</li><li><code>wp plugin list</code> - gets all the plugins.</li><li><code>wp plugin update akismet</code> - updates akismet plugin</li></ul><h2 id="backing-up-full-database" tabindex="-1"><a class="header-anchor" href="#backing-up-full-database"><span>Backing up full database</span></a></h2><p>This file will get stored in a directory that you determined in your <code>.env</code> as the <code>TEMP_DIR</code> variable.</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># In order for this command to work you need the following in your terminal profile (bash or zsh)</span></span>
<span class="line"><span class="token comment"># . /location-of-this-repo/wordpress/dev/bin/commands.sh as shown above</span></span>
<span class="line">wp db <span class="token builtin class-name">export</span> /tmp/WordPress/all-sites.sql --add-drop-table</span>
<span class="line"></span></code></pre></div><h2 id="useful-commands-for-migration-of-db" tabindex="-1"><a class="header-anchor" href="#useful-commands-for-migration-of-db"><span>Useful Commands for Migration of db</span></a></h2><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># updating guid and internal links</span></span>
<span class="line">wp search-replace <span class="token punctuation">\\</span></span>
<span class="line">   <span class="token parameter variable">--url</span><span class="token operator">=</span>source-url.com <span class="token punctuation">\\</span></span>
<span class="line">   --all-tables-with-prefix <span class="token punctuation">\\</span></span>
<span class="line">   <span class="token comment">#--dry-run \\</span></span>
<span class="line">   source-url.com <span class="token punctuation">\\</span></span>
<span class="line">   localhost </span>
<span class="line"></span>
<span class="line"><span class="token comment"># Updating the location of assets</span></span>
<span class="line">wp search-replace <span class="token punctuation">\\</span></span>
<span class="line">   <span class="token parameter variable">--url</span><span class="token operator">=</span>localhost <span class="token punctuation">\\</span></span>
<span class="line">   --all-tables-with-prefix <span class="token punctuation">\\</span></span>
<span class="line">   <span class="token comment">#--dry-run \\</span></span>
<span class="line">   source-url.com/app/uploads/sites/982 <span class="token punctuation">\\</span></span>
<span class="line">   localhost/wp-content/uploads/sites/3 </span>
<span class="line"></span></code></pre></div><h2 id="restoring-full-database" tabindex="-1"><a class="header-anchor" href="#restoring-full-database"><span>Restoring full database</span></a></h2><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>This command will replace your entire database, before running <code>wp db import</code> make sure you understand what this command does.</p></div><div class="language-bash" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">wp db <span class="token function">import</span> /tmp/WordPress/all-sites.sql</span>
<span class="line"></span></code></pre></div><h2 id="unit-tests" tabindex="-1"><a class="header-anchor" href="#unit-tests"><span>Unit tests</span></a></h2><p><code>wp-cli</code> provides <a href="https://developer.wordpress.org/cli/commands/scaffold/plugin-tests/" target="_blank" rel="noopener noreferrer">a way to set up and perform unit/integration tests</a> in WordPress&#39; official testing environment. If a plugin has been configured to use this method of unit testing, we can run those tests inside this docker deployment.</p><p>The WordPress Docker instance must be up and running to use the <code>wp_setup_tests</code> or <code>wp_test</code> commands (run <code>wp_start</code> to start the Docker instance).</p><h3 id="testing-setup" tabindex="-1"><a class="header-anchor" href="#testing-setup"><span>Testing Setup</span></a></h3><p>To set up the WP testing environment inside the WordPress container, run the command <code>wp_setup_tests</code> from anywhere.</p><p>If you get an error saying <code>command not found: wp_setup_tests</code>, follow the steps in the &quot;Helper functions&quot; section above.</p><h3 id="running-tests" tabindex="-1"><a class="header-anchor" href="#running-tests"><span>Running tests</span></a></h3><ol><li>Navigate to the plugin you want to execute tests on: <code>cd /path/to/your/plugin-directory</code></li><li>Run <code>wp_test</code>. <ul><li>If you get a message saying &quot;No tests executed&quot; the plugin is most likely not configured using the <code>wp scaffold plugin-tests</code> command so its tests cannot be executed this way. Run the unit tests locally instead (<code>composer run test</code>).</li><li>If you get a message saying &quot;Have you run bin/install-wp-tests.sh?&quot; you will need to run the <code>wp_setup_tests</code> command, then try again.</li></ul></li></ol>`,69)])])}const h=s(p,[["render",c]]),u=JSON.parse('{"path":"/guide/GettingStarted/deploy_locally.html","title":"Local development with WordPress","lang":"en-US","frontmatter":{"title":"Local development with WordPress","description":"Setup process for local development of Wordpress using Docker."},"git":{"contributors":[{"name":"ShawnTurple","username":"ShawnTurple","email":"45861534+ShawnTurple@users.noreply.github.com","commits":1,"url":"https://github.com/ShawnTurple"}],"changelog":[{"hash":"15a12f29942a2cf16ad9aa2931dc65a9a4041e86","time":1756162517000,"email":"45861534+ShawnTurple@users.noreply.github.com","author":"Shawn","message":"Merge pull request #87 from bcgov/feature/descw-3157-add-wpcli-docs-alternative-local-deploy"}]},"filePathRelative":"guide/GettingStarted/deploy_locally.md"}');export{h as comp,u as data};
